# 面试题没想出来的题目

1. bin log 有几种模式？里面存的是什么？

   + bin log 主要用于主从复制和辅助数据恢复。
   + bin log 的刷盘时机是：
     + 0：不去强制要求，由系统自行判断何时写入磁盘
     + 1：每次 commit 的时候都要将 binlog 写入磁盘【现在的默认设置】
     + N：每N个事务，才会将 binlog 写入磁盘
   + bin log 有三种模式：
     + Statement：包含产生数据变化的 **SQL 语句**
       + 【优】产生的日志文件少， IO 次数少
       + 【劣】在一些**不安全的语句上**，主从复制做不到数据一致，比如
         + 含有系统函数的语句，可能会在副本上返回不同的值，如 `RAND(), USER(),UUID(), SYSDATE() ....`（尤其是涉及到日期，从机上和主机上操作很容易出现不一致）
         + ...
       + 慢 SQL 会在副本中再执行一次
     + Row：**描述单个行的变化**【Default】
       + 【优】这是最安全的复制形式
       + 【优】不会出现某些特定情况下的存储过程，或 function，以及 trigger 的调用和触发无法被正确复制的问题
       + 【优】在 `INSERT/UPDATE/DELETE` 语句中，副本相对主行锁范围更小
       + 【劣】`RBL` 日志文件更大，比如一条update语句，如修改多条记录，则每一条修改都会有记录
     + Mixed：上述两者结合使用
       + 一般的语句修改使用 statment 格式保存 binlog
       + 一些函数，statement 等若是无法满足主从复制的需求，则采用 row 格式保存 binlog

# 网上看到的一些不错的题目

1. 拆入海量数据怎么办？
   + INSERT 批量插入，而不是一次插入一条。
     + 网络传输数据量少
     + 一次只涉及一个事务
     + binlog 写的东西少
   + 先删除索引，等全部插入完了再重建索引。
   + 禁用唯一性检查，全部插入完之后再排查。

2. 慢查询处理？

   慢查询日志是 MySQL 提供的一种日志记录，它用来记录在 MySQL 中响应时间超过阀值的语句，具体指运行时间超过long_query_time 值的 SQL，则会被记录到慢查询日志中。

   + 可以用 EXPLAIN 来分析原因。常见的原因是，索引没起作用。可以从索引失效的角度去解决。

   + 优化步骤走一走
   + 查一些分页之类的操作，尽可能的使用索引覆盖扫描，可以先只 SELECT 主键，然后再用主键查出其他列。